#!/usr/bin/env bash

#==============================================================================
#   nowplaying: wrapper of `mpc -f`
#==============================================================================

declare -r FORMAT_ARG=$1
declare -r ERROR_MSG="mpd or any song isn't playing :("
declare DEFAULT_FORMAT="[%artist% - ][%title%]|[%file%]"

check_isplaying () {
    local -r status="$(mpc status)"
    [[ $status == *"[playing]"* ]] && return 0
    [[ $status == *"[paused]"*  ]] && return 0
    echo $ERROR_MSG > /dev/stderr  && exit 1
}

format () {
    [[ $MPC_FORMAT == "" ]] || DEFAULT_FORMAT="$MPC_FORMAT"
    [[ $FORMAT_ARG == "" ]] && echo "$DEFAULT_FORMAT" || echo "$FORMAT_ARG"
}

check_isplaying
echo $(mpc -f "$(format)" 2>/dev/null | head -n -2)
